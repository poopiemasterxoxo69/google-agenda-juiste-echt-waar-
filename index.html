<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Agenda Tool</title>
<style>
body { font-family: sans-serif; max-width: 700px; margin: auto; padding: 20px; }
h1 { text-align: center; }
textarea, select, button { width: 100%; margin-top: 10px; font-size: 16px; padding: 10px; }
</style>
</head>
<body>

<h1>Agenda Tool</h1>
<button onclick="handleAuthClick()">Log in met Google</button>
<p id="status">Niet ingelogd</p>

<textarea id="inputText" rows="6" placeholder="Bijv: kapper donderdag 15:00&#10;of: rijles maandag 14:00"></textarea>
<button onclick="addMultipleEvents()">➕ Voeg toe aan agenda</button>

<script src="https://apis.google.com/js/api.js" onload="gapiLoaded()" async defer></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
let tokenClient;
let accessToken = null;

function gapiLoaded() {
  gapi.load('client', initializeGapiClient);
}

async function initializeGapiClient() {
  await gapi.client.init({
    apiKey: '', // optioneel
    discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],
  });
}

window.onload = () => {
  if (typeof google !== "undefined") {
    tokenClient = google.accounts.oauth2.initTokenClient({
      client_id: 'JOUW_CLIENT_ID.apps.googleusercontent.com',
      scope: 'https://www.googleapis.com/auth/calendar.events',
      callback: (tokenResponse) => {
        accessToken = tokenResponse.access_token;
        gapi.client.setToken({ access_token: accessToken });
        document.getElementById("status").innerText = "Ingelogd ✔";
      },
    });
  }
};

window.handleAuthClick = () => {
  if (tokenClient) {
    tokenClient.requestAccessToken();
  } else {
    alert("Google auth is nog niet geladen.");
  }
};

async function addMultipleEvents() {
  if (!accessToken) {
    alert("Log eerst in met Google.");
    return;
  }

  const input = document.getElementById("inputText").value;
  const event = {
    summary: input.trim() || "Test event",
    start: { dateTime: new Date().toISOString(), timeZone: 'Europe/Amsterdam' },
    end: { dateTime: new Date(Date.now() + 30*60000).toISOString(), timeZone: 'Europe/Amsterdam' }
  };

  try {
    await gapi.client.calendar.events.insert({
      calendarId: 'primary',
      resource: event,
    });
    alert("Event toegevoegd!");
  } catch (e) {
    console.error(e);
    alert("Fout bij toevoegen event.");
  }
}
</script>

</body>
</html>
