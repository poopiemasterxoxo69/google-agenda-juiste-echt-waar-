<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Agenda Tool met Consensus</title>
<style>
body { font-family: sans-serif; background-color: #f5f5f5; max-width: 700px; margin: auto; padding: 20px; }
h1 { text-align: center; }
textarea, select, button { width: 100%; margin-top: 10px; font-size: 16px; padding: 10px; }
#kleur { margin-bottom: 20px; }
label { font-weight: bold; }
</style>
</head>
<body>
<h1>Agenda Tool</h1>
<button onclick="handleAuthClick()">Log in met Google</button>
<p id="status">Niet ingelogd</p>

<textarea id="inputText" rows="4" placeholder="Bijv: kapper maandag 14:00 of vergadering 5 juli 10:00-11:00"></textarea>

<label for="kleur">Kies kleur:</label>
<select id="kleur">
<option value="random" selected>🎲 Willekeurig</option>
<option value="11">❤️ Rood</option>
<option value="6">🟧 Oranje</option>
<option value="5">💛 Geel</option>
<option value="10">💚 Donkergroen</option>
<option value="2">💚 Lichtgroen</option>
<option value="9">💙 Blauw</option>
<option value="3">💜 Lavendel</option>
<option value="4">🍇 Paars</option>
<option value="1">💗 Roze</option>
<option value="8">⚫ Grijs</option>
</select>

<label><input type="checkbox" id="heleDag"> Hele dag</label>

<button onclick="addEvent()">➕ Voeg toe aan agenda</button>

<script src="https://apis.google.com/js/api.js" onload="gapiLoaded()" async defer></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
let tokenClient; let accessToken = null;
function gapiLoaded(){ gapi.load('client', initializeGapiClient); }
async function initializeGapiClient(){
  await gapi.client.init({ apiKey:'', discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"] });
}
window.onload = ()=>{
  if(typeof google!=="undefined") tokenClient = google.accounts.oauth2.initTokenClient({
    client_id:'424624995566-0aprf3c3739snsn0q752kj4slifditj3.apps.googleusercontent.com',
    scope:'https://www.googleapis.com/auth/calendar.events',
    callback:(t)=>{ accessToken=t.access_token; document.getElementById("status").innerText="Ingelogd ✔"; }
  });
};
function handleAuthClick(){ if(tokenClient) tokenClient.requestAccessToken(); else alert("Google auth niet geladen."); }

async function getConsensus(text){
  const aiUrls=[ "https://google-agenda-juiste-echt-waar.vercel.app/api/parse-groq", "https://google-agenda-juiste-echt-waar.vercel.app/api/parse-hf" ];
  const jsParsed=parseTextToEvent(text);
  const aiResults=await Promise.all(aiUrls.map(async url=>{ try{let r=await fetch(url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tekst:text})}); return await r.json();}catch{return null;} }));
  const sources=[jsParsed,...aiResults].filter(x=>x);
  const fields=['summary','start','end'];
  let evt={summary:null,start:null,end:null}, errors=[];
  // compare
  let titles = sources.map(s=>s.summary);
  let title = titles.sort((a,b)=> sources.filter(x=>x.summary==a).length - sources.filter(x=>x.summary==b).length).pop();
  if(sources.filter(x=>x.summary==title).length>=2) evt.summary=title; else errors.push("naam");
  // datum/tijd combine omitted for brevity...
  return errors.length?{error:"Geen consensus: "+errors.join(", ")}:evt;
}
function parseTextToEvent(text){/* jouw bestaande parser */ return {summary:"",start:{dateTime:""},end:{dateTime:""}};}
async function checkConflict(e){/* */return false;}
async function addEvent(){/* gebruik getConsensus etc. */}

</script>
</body>
</html>