<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<title>Tijd Extractor</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea { width: 100%; height: 100px; }
    button { padding: 10px 20px; margin-top: 10px; }
    .result { margin-top: 20px; }
</style>
</head>
<body>

<h1>Tijd Extractor</h1>
<p>Voer hier je verhaaltje in. Voorbeeld: <em>ik bleef van 5 april tot 8 juni, en om half 5 ging het regenen</em></p>

<textarea id="inputText"></textarea>
<br>
<button onclick="extractTijden()">Extract Tijden</button>

<div class="result" id="result"></div>

<script>
function extractTijden() {
    const text = document.getElementById('inputText').value.toLowerCase();
    const resultDiv = document.getElementById('result');
    let output = "<h3>Gevonden tijden:</h3>";

    const tijden = [];

    // Verbeterde regex met toleranties voor kleine typfouten
    const tijdRegex = /(\b(?:hal\s*|half|h)ocker\s*|kwart\s*(?:over|voor|voor|voor|vvoor|vooor)|\d{1,2}:\d{2}|\d{1,2}\s*uur)/gi;
    
    // Iets uitgebreidere regex voor hulp bij foute spelling
    // Het detecteert hoofdmatige fouten, maar voor volledige fouttolerantie is complex
    const matches = text.match(tijdRegex);

    if (matches) {
        matches.forEach(t => {
            const norm = normalizeTijd(t.trim());
            if (norm) {
                tijden.push(`${t.trim()} â†’ ${norm}`);
            }
        });
    }

    if (tijden.length > 0) {
        output += "<ul>";
        tijden.forEach(t => {
            output += `<li>${t}</li>`;
        });
        output += "</ul>";
    } else {
        output += "<p>Geen tijden gevonden.</p>";
    }

    resultDiv.innerHTML = output;
}

function normalizeTijd(tijdStr) {
    let uur = 0, min = 0;

    // Leer de baseline regex voor tijdsherkenning
    const halfRegex = /(?:hal\s*|half|h)(?:\s*ocker)?/i; // bv 'half', 'hal', 'h' en varianten
    const kwartOverRegex = /kwart\s*(?:over|vvoor|vooor|voor)?\s*(\d{1,2})/i; // 'kwart over 5', 'kwart vvoor 5'
    const kwartVoorRegex = /kwart\s*voor\s*(\d{1,2})/i;
    const hhmmRegex = /(\d{1,2})\s*:\s*(\d{2})/;
    const uurRegex = /^(\d{1,2})\s*uur$/;

    // Detectie van verschillende tijdsformaten
    if (halfRegex.test(tijdStr)) {
        const match = tijdStr.match(/(\d{1,2})/);
        let h = match ? parseInt(match[1]) : 0;
        uur = h - 1;
        min = 30;
    } else if (kwartOverRegex.test(tijdStr)) {
        const match = tijdStr.match(/\d{1,2}/);
        let h = match ? parseInt(match[0]) : 0;
        uur = h;
        min = 15;
    } else if (kwartVoorRegex.test(tijdStr)) {
        const match = tijdStr.match(/\d{1,2}/);
        let h = match ? parseInt(match[0]) : 0;
        uur = h - 1;
        min = 45;
    } else if (hhmmRegex.test(tijdStr)) {
        const match = tijdStr.match(hhmmRegex);
        uur = parseInt(match[1]);
        min = parseInt(match[2]);
    } else if (uurRegex.test(tijdStr)) {
        const match = tijdStr.match(uurRegex);
        uur = parseInt(match[1]);
        min = 0;
    } else {
        return null; // geen herkenning
    }

    // Schooltijd of avondtijd correct interpreteren
    if (uur >= 1 && uur < 8) {
        uur += 12; // van 1-7 uur naar 13-19
    }

    // Corrigeer uren die kleiner zijn dan 0 of >=24
    if (uur < 0) uur += 24;
    if (uur >= 24) uur -= 24;

    return `${uur.toString().padStart(2, '0')}:${min.toString().padStart(2, '0')}`;
}
</script>

</body>
</html>